---
# Handle cluster destruction with count expansion
# count represents the TOTAL number of clusters that were created:
# - count: 1 → destroy base name (no suffix)
# - count: 2 → destroy name-1, name-2 (2 clusters, no base)
# - count: 3 → destroy name-1, name-2, name-3 (3 clusters, no base)

- name: "destroy | destroy cluster instances for {{ cluster_item.name }}"
  include_tasks: hcp-destroy-cluster.yml
  loop: "{{ range(1, (cluster_item.count | default(1)) + 1) | list }}"
  loop_control:
    loop_var: instance_num
  vars:
    cluster: "{{ cluster_item | combine({'name': cluster_item.name + '-' + (instance_num | string) if (cluster_item.count | default(1)) > 1 else cluster_item.name}, recursive=False) }}"
  when: destroy
